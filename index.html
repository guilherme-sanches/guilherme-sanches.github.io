<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produtos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        h2 {
            color: #333;
            margin: 30px 0 15px 0;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .secao-produtos {
            margin-bottom: 40px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .lucro-positivo {
            color: #00b894;
            font-weight: bold;
        }
        
        .lucro-negativo {
            color: #d63031;
            font-weight: bold;
        }
        
        .lucro-zero {
            color: #636e72;
        }
        
        .form-venda {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-remover {
            background: linear-gradient(135deg, #d63031 0%, #e17055 100%);
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-exportar {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            padding: 8px 16px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .resumo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .resumo h2 {
            margin-top: 0;
        }
        
        .resumo-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .resumo-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #667eea;
        }
        
        .valor {
            font-weight: 600;
        }
        
        .tabela-vendas {
            overflow-x: auto;
        }
        
        .sem-vendas {
            text-align: center;
            padding: 30px;
            color: #636e72;
            font-style: italic;
        }
        
        .botoes-exportar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Controle de Entrada e Sa√≠da de Produtos</h1>
        
        <div class="secao-produtos">
            <h2>
                Cadastro de Produtos
                <button class="btn-exportar" onclick="exportarProdutosCSV()">
                    üì• Exportar Produtos (CSV)
                </button>
            </h2>
            <table>
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Custo Unit√°rio (R$)</th>
                        <th>Qtd. Entrada</th>
                        <th>Pre√ßo Venda (R$)</th>
                        <th>Estoque Atual</th>
                    </tr>
                </thead>
                <tbody id="tabelaProdutos">
                </tbody>
            </table>
        </div>
        
        <div class="secao-vendas">
            <h2>Registrar Venda</h2>
            <div class="form-venda">
                <div class="form-group">
                    <label for="dataVenda">Data:</label>
                    <input type="date" id="dataVenda">
                </div>
                <div class="form-group">
                    <label for="produtoVenda">Produto:</label>
                    <select id="produtoVenda">
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quantidadeVenda">Quantidade:</label>
                    <input type="number" id="quantidadeVenda" min="1" value="1">
                </div>
                <div class="form-group">
                    <button onclick="adicionarVenda()">‚ûï Adicionar Venda</button>
                </div>
            </div>
            
            <h2>
                Hist√≥rico de Vendas
                <div class="botoes-exportar">
                    <button class="btn-exportar" onclick="exportarVendasCSV()">
                        üì• Exportar Vendas (CSV)
                    </button>
                    <button class="btn-exportar" onclick="exportarResumoCSV()">
                        üì• Exportar Resumo (CSV)
                    </button>
                </div>
            </h2>
            <div class="tabela-vendas">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Produto</th>
                            <th>Quantidade</th>
                            <th>Pre√ßo Unit. (R$)</th>
                            <th>Total Venda (R$)</th>
                            <th>Custo Unit. (R$)</th>
                            <th>Lucro (R$)</th>
                            <th>A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaVendas">
                    </tbody>
                </table>
                <div id="mensagemSemVendas" class="sem-vendas">
                    Nenhuma venda registrada ainda.
                </div>
            </div>
        </div>
        
        <div class="resumo">
            <h2>Resumo Financeiro</h2>
            <div class="resumo-item">
                <span>Total Investido em Estoque:</span>
                <span class="valor" id="totalInvestido">R$ 0,00</span>
            </div>
            <div class="resumo-item">
                <span>Total em Vendas:</span>
                <span class="valor" id="totalVendas">R$ 0,00</span>
            </div>
            <div class="resumo-item">
                <span>Lucro Total:</span>
                <span class="valor" id="lucroTotal">R$ 0,00</span>
            </div>
        </div>
    </div>
    
    <script>
        const produtos = [
            { nome: 'Carga R√°pida', custo: 0, entrada: 0, precoVenda: 0 },
            { nome: 'Alho', custo: 0, entrada: 0, precoVenda: 0 },
            { nome: 'Torresmo', custo: 0, entrada: 0, precoVenda: 0 },
            { nome: 'Peixe', custo: 0, entrada: 0, precoVenda: 0 }
        ];
        
        let vendas = [];
        
		carregarDados();
		
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function formatarData(data) {
            const [ano, mes, dia] = data.split('-');
            return `${dia}/${mes}/${ano}`;
        }
        
        function calcularEstoque(produto) {
            const vendasProduto = vendas.filter(v => v.produto === produto.nome);
            const totalVendido = vendasProduto.reduce((sum, v) => sum + v.quantidade, 0);
            return produto.entrada - totalVendido;
        }
        
        function renderizarProdutos() {
            const tbody = document.getElementById('tabelaProdutos');
            tbody.innerHTML = '';
            
            produtos.forEach((produto, index) => {
                const tr = document.createElement('tr');
                const estoque = calcularEstoque(produto);
                
                tr.innerHTML = `
                    <td><input type="text" value="${produto.nome}" onchange="atualizarProduto(${index}, 'nome', this.value)"></td>
                    <td><input type="number" step="0.01" min="0" value="${produto.custo}" onchange="atualizarProduto(${index}, 'custo', parseFloat(this.value) || 0)"></td>
                    <td><input type="number" min="0" value="${produto.entrada}" onchange="atualizarProduto(${index}, 'entrada', parseInt(this.value) || 0)"></td>
                    <td><input type="number" step="0.01" min="0" value="${produto.precoVenda}" onchange="atualizarProduto(${index}, 'precoVenda', parseFloat(this.value) || 0)"></td>
                    <td><strong>${estoque}</strong></td>
                `;
                
                tbody.appendChild(tr);
            });
            
            atualizarSelectProdutos();
        }
        
        function atualizarProduto(index, campo, valor) {
            const valorAnterior = produtos[index][campo];
            produtos[index][campo] = valor;
            
            if (campo === 'nome') {
                vendas.forEach(venda => {
                    if (venda.produto === valorAnterior) {
                        venda.produto = valor;
                    }
                });
            }
            
            renderizarProdutos();
            renderizarVendas();
            atualizarResumo();
			salvarDados();
        }
        
        function atualizarSelectProdutos() {
            const select = document.getElementById('produtoVenda');
            const valorAtual = select.value;
            select.innerHTML = '<option value="">Selecione...</option>';
            
            produtos.forEach((produto, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = produto.nome;
                select.appendChild(option);
            });
            
            select.value = valorAtual;
        }
        
        function adicionarVenda() {
            const data = document.getElementById('dataVenda').value;
            const produtoIndex = document.getElementById('produtoVenda').value;
            const quantidade = parseInt(document.getElementById('quantidadeVenda').value);
            
            if (!data || produtoIndex === '' || !quantidade || quantidade <= 0) {
                alert('Por favor, preencha todos os campos corretamente!');
                return;
            }
            
            const produto = produtos[produtoIndex];
            const estoque = calcularEstoque(produto);
            
            if (quantidade > estoque) {
                alert(`Estoque insuficiente! Dispon√≠vel: ${estoque} unidades`);
                return;
            }
            
            vendas.push({
                data: data,
                produto: produto.nome,
                quantidade: quantidade,
                precoVenda: produto.precoVenda,
                custo: produto.custo
            });
            
            vendas.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            document.getElementById('dataVenda').value = '';
            document.getElementById('produtoVenda').value = '';
            document.getElementById('quantidadeVenda').value = '1';
            
            renderizarProdutos();
            renderizarVendas();
            atualizarResumo();
			salvarDados();
        }
        
        function removerVenda(index) {
            if (confirm('Deseja realmente remover esta venda?')) {
                vendas.splice(index, 1);
                renderizarProdutos();
                renderizarVendas();
                atualizarResumo();
				salvarDados();
            }
        }
        
        function renderizarVendas() {
            const tbody = document.getElementById('tabelaVendas');
            const mensagem = document.getElementById('mensagemSemVendas');
            
            if (vendas.length === 0) {
                tbody.innerHTML = '';
                mensagem.style.display = 'block';
                return;
            }
            
            mensagem.style.display = 'none';
            tbody.innerHTML = '';
            
            vendas.forEach((venda, index) => {
                const tr = document.createElement('tr');
                const totalVenda = venda.quantidade * venda.precoVenda;
                const custoTotal = venda.quantidade * venda.custo;
                const lucro = totalVenda - custoTotal;
                
                let classeCorLucro = 'lucro-zero';
                if (lucro > 0) classeCorLucro = 'lucro-positivo';
                else if (lucro < 0) classeCorLucro = 'lucro-negativo';
                
                tr.innerHTML = `
                    <td>${formatarData(venda.data)}</td>
                    <td>${venda.produto}</td>
                    <td>${venda.quantidade}</td>
                    <td>R$ ${formatarMoeda(venda.precoVenda)}</td>
                    <td>R$ ${formatarMoeda(totalVenda)}</td>
                    <td>R$ ${formatarMoeda(venda.custo)}</td>
                    <td class="${classeCorLucro}">R$ ${formatarMoeda(lucro)}</td>
                    <td><button class="btn-remover" onclick="removerVenda(${index})">üóëÔ∏è Remover</button></td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        function atualizarResumo() {
            let totalInvestido = 0;
            let totalVendas = 0;
            
            produtos.forEach(produto => {
                totalInvestido += produto.custo * produto.entrada;
            });
            
            vendas.forEach(venda => {
                totalVendas += venda.quantidade * venda.precoVenda;
            });
            
            const lucroTotal = totalVendas - vendas.reduce((sum, v) => sum + (v.quantidade * v.custo), 0);
            
            document.getElementById('totalInvestido').textContent = 'R$ ' + formatarMoeda(totalInvestido);
            document.getElementById('totalVendas').textContent = 'R$ ' + formatarMoeda(totalVendas);
            
            const elementoLucro = document.getElementById('lucroTotal');
            elementoLucro.textContent = 'R$ ' + formatarMoeda(lucroTotal);
            
            if (lucroTotal > 0) {
                elementoLucro.className = 'valor lucro-positivo';
            } else if (lucroTotal < 0) {
                elementoLucro.className = 'valor lucro-negativo';
            } else {
                elementoLucro.className = 'valor lucro-zero';
            }
        }
        
        // Fun√ß√µes de exporta√ß√£o CSV
        function converterParaCSV(dados, colunas) {
            const linhas = [colunas.join(',')];
            
            dados.forEach(item => {
                const linha = colunas.map(col => {
                    let valor = item[col];
                    if (typeof valor === 'string' && valor.includes(',')) {
                        valor = `"${valor}"`;
                    }
                    return valor;
                });
                linhas.push(linha.join(','));
            });
            
            return linhas.join('\n');
        }
        
        function baixarCSV(conteudo, nomeArquivo) {
            const blob = new Blob(['\uFEFF' + conteudo], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', nomeArquivo);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function exportarProdutosCSV() {
            const dadosExportar = produtos.map(p => ({
                Produto: p.nome,
                'Custo Unit√°rio (R$)': p.custo.toFixed(2),
                'Qtd. Entrada': p.entrada,
                'Pre√ßo Venda (R$)': p.precoVenda.toFixed(2),
                'Estoque Atual': calcularEstoque(p)
            }));
            
            const csv = converterParaCSV(dadosExportar, ['Produto', 'Custo Unit√°rio (R$)', 'Qtd. Entrada', 'Pre√ßo Venda (R$)', 'Estoque Atual']);
            baixarCSV(csv, 'produtos.csv');
        }
        
        function exportarVendasCSV() {
            if (vendas.length === 0) {
                alert('N√£o h√° vendas para exportar!');
                return;
            }
            
            const dadosExportar = vendas.map(v => {
                const totalVenda = v.quantidade * v.precoVenda;
                const custoTotal = v.quantidade * v.custo;
                const lucro = totalVenda - custoTotal;
                
                return {
                    Data: formatarData(v.data),
                    Produto: v.produto,
                    Quantidade: v.quantidade,
                    'Pre√ßo Unit. (R$)': v.precoVenda.toFixed(2),
                    'Total Venda (R$)': totalVenda.toFixed(2),
                    'Custo Unit. (R$)': v.custo.toFixed(2),
                    'Lucro (R$)': lucro.toFixed(2)
                };
            });
            
            const csv = converterParaCSV(dadosExportar, ['Data', 'Produto', 'Quantidade', 'Pre√ßo Unit. (R$)', 'Total Venda (R$)', 'Custo Unit. (R$)', 'Lucro (R$)']);
            baixarCSV(csv, 'vendas.csv');
        }
        
        function exportarResumoCSV() {
            let totalInvestido = 0;
            let totalVendasValor = 0;
            
            produtos.forEach(produto => {
                totalInvestido += produto.custo * produto.entrada;
            });
            
            vendas.forEach(venda => {
                totalVendasValor += venda.quantidade * venda.precoVenda;
            });
            
            const lucroTotal = totalVendasValor - vendas.reduce((sum, v) => sum + (v.quantidade * v.custo), 0);
            
            const dadosExportar = [
                { Descri√ß√£o: 'Total Investido em Estoque', 'Valor (R$)': totalInvestido.toFixed(2) },
                { Descri√ß√£o: 'Total em Vendas', 'Valor (R$)': totalVendasValor.toFixed(2) },
                { Descri√ß√£o: 'Lucro Total', 'Valor (R$)': lucroTotal.toFixed(2) }
            ];
            
            const csv = converterParaCSV(dadosExportar, ['Descri√ß√£o', 'Valor (R$)']);
            baixarCSV(csv, 'resumo_financeiro.csv');
        }
        
        document.getElementById('dataVenda').valueAsDate = new Date();
        
		//Fun√ß√µes de armazenamento local
function salvarDados() {
    localStorage.setItem('produtos', JSON.stringify(produtos));
    localStorage.setItem('vendas', JSON.stringify(vendas));
}

function carregarDados() {
    const produtosSalvos = localStorage.getItem('produtos');
    const vendasSalvas = localStorage.getItem('vendas');

    if (produtosSalvos) {
        const parsed = JSON.parse(produtosSalvos);
        parsed.forEach((p, i) => {
            if (produtos[i]) {
                produtos[i] = { ...produtos[i], ...p };
            } else {
                produtos.push(p);
            }
        });
    }

    if (vendasSalvas) {
        vendas = JSON.parse(vendasSalvas);
    }
}

		
        renderizarProdutos();
        renderizarVendas();
        atualizarResumo();
    </script>
	
	<button onclick="localStorage.clear(); location.reload();">
üóëÔ∏è Limpar todos os dados
</button>

	
</body>
</html>